{"dependencies":[{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"],"imports":1}},{"name":"../Utilities/infoLog","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":13,"column":16},"end":{"line":13,"column":47}}],"key":"JOQiliPDxvxpS4qCtoh0JoUHvB4=","exportNames":["*"],"imports":1}},{"name":"invariant","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":14,"column":18},"end":{"line":14,"column":38}}],"key":"oQpL0Es3H146KnQH9ygFeHrzVP4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  'use strict';\n\n  var _classCallCheck = require(_dependencyMap[0], \"@babel/runtime/helpers/classCallCheck\").default;\n  var _createClass = require(_dependencyMap[1], \"@babel/runtime/helpers/createClass\").default;\n  var infoLog = require(_dependencyMap[2], \"../Utilities/infoLog\");\n  var invariant = require(_dependencyMap[3], \"invariant\");\n  var DEBUG = false;\n  var TaskQueue = /*#__PURE__*/function () {\n    function TaskQueue(_ref) {\n      var onMoreTasks = _ref.onMoreTasks;\n      _classCallCheck(this, TaskQueue);\n      this._onMoreTasks = onMoreTasks;\n      this._queueStack = [{\n        tasks: [],\n        popable: false\n      }];\n    }\n    return _createClass(TaskQueue, [{\n      key: \"enqueue\",\n      value: function enqueue(task) {\n        this._getCurrentQueue().push(task);\n      }\n    }, {\n      key: \"enqueueTasks\",\n      value: function enqueueTasks(tasks) {\n        var _this = this;\n        tasks.forEach(function (task) {\n          return _this.enqueue(task);\n        });\n      }\n    }, {\n      key: \"cancelTasks\",\n      value: function cancelTasks(tasksToCancel) {\n        this._queueStack = this._queueStack.map(function (queue) {\n          return Object.assign({}, queue, {\n            tasks: queue.tasks.filter(function (task) {\n              return tasksToCancel.indexOf(task) === -1;\n            })\n          });\n        }).filter(function (queue, idx) {\n          return queue.tasks.length > 0 || idx === 0;\n        });\n      }\n    }, {\n      key: \"hasTasksToProcess\",\n      value: function hasTasksToProcess() {\n        return this._getCurrentQueue().length > 0;\n      }\n    }, {\n      key: \"processNext\",\n      value: function processNext() {\n        var queue = this._getCurrentQueue();\n        if (queue.length) {\n          var task = queue.shift();\n          try {\n            if (typeof task === 'object' && task.gen) {\n              DEBUG && infoLog('TaskQueue: genPromise for task ' + task.name);\n              this._genPromise(task);\n            } else if (typeof task === 'object' && task.run) {\n              DEBUG && infoLog('TaskQueue: run task ' + task.name);\n              task.run();\n            } else {\n              invariant(typeof task === 'function', 'Expected Function, SimpleTask, or PromiseTask, but got:\\n' + JSON.stringify(task, null, 2));\n              DEBUG && infoLog('TaskQueue: run anonymous task');\n              task();\n            }\n          } catch (e) {\n            e.message = 'TaskQueue: Error with task ' + (task.name || '') + ': ' + e.message;\n            throw e;\n          }\n        }\n      }\n    }, {\n      key: \"_getCurrentQueue\",\n      value: function _getCurrentQueue() {\n        var stackIdx = this._queueStack.length - 1;\n        var queue = this._queueStack[stackIdx];\n        if (queue.popable && queue.tasks.length === 0 && this._queueStack.length > 1) {\n          this._queueStack.pop();\n          DEBUG && infoLog('TaskQueue: popped queue: ', {\n            stackIdx: stackIdx,\n            queueStackSize: this._queueStack.length\n          });\n          return this._getCurrentQueue();\n        } else {\n          return queue.tasks;\n        }\n      }\n    }, {\n      key: \"_genPromise\",\n      value: function _genPromise(task) {\n        var _this2 = this;\n        this._queueStack.push({\n          tasks: [],\n          popable: false\n        });\n        var stackIdx = this._queueStack.length - 1;\n        var stackItem = this._queueStack[stackIdx];\n        DEBUG && infoLog('TaskQueue: push new queue: ', {\n          stackIdx: stackIdx\n        });\n        DEBUG && infoLog('TaskQueue: exec gen task ' + task.name);\n        task.gen().then(function () {\n          DEBUG && infoLog('TaskQueue: onThen for gen task ' + task.name, {\n            stackIdx: stackIdx,\n            queueStackSize: _this2._queueStack.length\n          });\n          stackItem.popable = true;\n          _this2.hasTasksToProcess() && _this2._onMoreTasks();\n        }).catch(function (ex) {\n          setTimeout(function () {\n            ex.message = `TaskQueue: Error resolving Promise in task ${task.name}: ${ex.message}`;\n            throw ex;\n          }, 0);\n        });\n      }\n    }]);\n  }();\n  module.exports = TaskQueue;\n});","lineCount":121,"map":[[2,2,11,0],[2,14,11,12],[4,2,11,13],[4,6,11,13,"_classCallCheck"],[4,21,11,13],[4,24,11,13,"require"],[4,31,11,13],[4,32,11,13,"_dependencyMap"],[4,46,11,13],[4,92,11,13,"default"],[4,99,11,13],[5,2,11,13],[5,6,11,13,"_createClass"],[5,18,11,13],[5,21,11,13,"require"],[5,28,11,13],[5,29,11,13,"_dependencyMap"],[5,43,11,13],[5,86,11,13,"default"],[5,93,11,13],[6,2,13,0],[6,6,13,6,"infoLog"],[6,13,13,13],[6,16,13,16,"require"],[6,23,13,23],[6,24,13,23,"_dependencyMap"],[6,38,13,23],[6,65,13,46],[6,66,13,47],[7,2,14,0],[7,6,14,6,"invariant"],[7,15,14,15],[7,18,14,18,"require"],[7,25,14,25],[7,26,14,25,"_dependencyMap"],[7,40,14,25],[7,56,14,37],[7,57,14,38],[8,2,26,0],[8,6,26,6,"DEBUG"],[8,11,26,18],[8,14,26,21],[8,19,26,26],[9,2,26,27],[9,6,44,6,"TaskQueue"],[9,15,44,15],[10,4,52,2],[10,13,52,2,"TaskQueue"],[10,23,52,2,"_ref"],[10,27,52,2],[10,29,52,61],[11,6,52,61],[11,10,52,15,"onMoreTasks"],[11,21,52,26],[11,24,52,26,"_ref"],[11,28,52,26],[11,29,52,15,"onMoreTasks"],[11,40,52,26],[12,6,52,26,"_classCallCheck"],[12,21,52,26],[12,28,52,26,"TaskQueue"],[12,37,52,26],[13,6,53,4],[13,10,53,8],[13,11,53,9,"_onMoreTasks"],[13,23,53,21],[13,26,53,24,"onMoreTasks"],[13,37,53,35],[14,6,54,4],[14,10,54,8],[14,11,54,9,"_queueStack"],[14,22,54,20],[14,25,54,23],[14,26,54,24],[15,8,54,25,"tasks"],[15,13,54,30],[15,15,54,32],[15,17,54,34],[16,8,54,36,"popable"],[16,15,54,43],[16,17,54,45],[17,6,54,50],[17,7,54,51],[17,8,54,52],[18,4,55,2],[19,4,55,3],[19,11,55,3,"_createClass"],[19,23,55,3],[19,24,55,3,"TaskQueue"],[19,33,55,3],[20,6,55,3,"key"],[20,9,55,3],[21,6,55,3,"value"],[21,11,55,3],[21,13,62,2],[21,22,62,2,"enqueue"],[21,29,62,9,"enqueue"],[21,30,62,10,"task"],[21,34,62,20],[21,36,62,28],[22,8,63,4],[22,12,63,8],[22,13,63,9,"_getCurrentQueue"],[22,29,63,25],[22,30,63,26],[22,31,63,27],[22,32,63,28,"push"],[22,36,63,32],[22,37,63,33,"task"],[22,41,63,37],[22,42,63,38],[23,6,64,2],[24,4,64,3],[25,6,64,3,"key"],[25,9,64,3],[26,6,64,3,"value"],[26,11,64,3],[26,13,66,2],[26,22,66,2,"enqueueTasks"],[26,34,66,14,"enqueueTasks"],[26,35,66,15,"tasks"],[26,40,66,33],[26,42,66,41],[27,8,66,41],[27,12,66,41,"_this"],[27,17,66,41],[28,8,67,4,"tasks"],[28,13,67,9],[28,14,67,10,"forEach"],[28,21,67,17],[28,22,67,18],[28,32,67,18,"task"],[28,36,67,22],[29,10,67,22],[29,17,67,26,"_this"],[29,22,67,30],[29,23,67,31,"enqueue"],[29,30,67,38],[29,31,67,39,"task"],[29,35,67,43],[29,36,67,44],[30,8,67,44],[30,10,67,45],[31,6,68,2],[32,4,68,3],[33,6,68,3,"key"],[33,9,68,3],[34,6,68,3,"value"],[34,11,68,3],[34,13,70,2],[34,22,70,2,"cancelTasks"],[34,33,70,13,"cancelTasks"],[34,34,70,14,"tasksToCancel"],[34,47,70,40],[34,49,70,48],[35,8,72,4],[35,12,72,8],[35,13,72,9,"_queueStack"],[35,24,72,20],[35,27,72,23],[35,31,72,27],[35,32,72,28,"_queueStack"],[35,43,72,39],[35,44,73,7,"map"],[35,47,73,10],[35,48,73,11],[35,58,73,11,"queue"],[35,63,73,16],[36,10,73,16],[36,17,73,16,"Object"],[36,23,73,16],[36,24,73,16,"assign"],[36,30,73,16],[36,35,74,11,"queue"],[36,40,74,16],[37,12,75,8,"tasks"],[37,17,75,13],[37,19,75,15,"queue"],[37,24,75,20],[37,25,75,21,"tasks"],[37,30,75,26],[37,31,75,27,"filter"],[37,37,75,33],[37,38,75,34],[37,48,75,34,"task"],[37,52,75,38],[38,14,75,38],[38,21,75,42,"tasksToCancel"],[38,34,75,55],[38,35,75,56,"indexOf"],[38,42,75,63],[38,43,75,64,"task"],[38,47,75,68],[38,48,75,69],[38,53,75,74],[38,54,75,75],[38,55,75,76],[39,12,75,76],[40,10,75,77],[41,8,75,77],[41,9,76,8],[41,10,76,9],[41,11,77,7,"filter"],[41,17,77,13],[41,18,77,14],[41,28,77,15,"queue"],[41,33,77,20],[41,35,77,22,"idx"],[41,38,77,25],[42,10,77,25],[42,17,77,30,"queue"],[42,22,77,35],[42,23,77,36,"tasks"],[42,28,77,41],[42,29,77,42,"length"],[42,35,77,48],[42,38,77,51],[42,39,77,52],[42,43,77,56,"idx"],[42,46,77,59],[42,51,77,64],[42,52,77,65],[43,8,77,65],[43,10,77,66],[44,6,78,2],[45,4,78,3],[46,6,78,3,"key"],[46,9,78,3],[47,6,78,3,"value"],[47,11,78,3],[47,13,90,2],[47,22,90,2,"hasTasksToProcess"],[47,39,90,19,"hasTasksToProcess"],[47,40,90,19],[47,42,90,31],[48,8,91,4],[48,15,91,11],[48,19,91,15],[48,20,91,16,"_getCurrentQueue"],[48,36,91,32],[48,37,91,33],[48,38,91,34],[48,39,91,35,"length"],[48,45,91,41],[48,48,91,44],[48,49,91,45],[49,6,92,2],[50,4,92,3],[51,6,92,3,"key"],[51,9,92,3],[52,6,92,3,"value"],[52,11,92,3],[52,13,97,2],[52,22,97,2,"processNext"],[52,33,97,13,"processNext"],[52,34,97,13],[52,36,97,22],[53,8,98,4],[53,12,98,10,"queue"],[53,17,98,15],[53,20,98,18],[53,24,98,22],[53,25,98,23,"_getCurrentQueue"],[53,41,98,39],[53,42,98,40],[53,43,98,41],[54,8,99,4],[54,12,99,8,"queue"],[54,17,99,13],[54,18,99,14,"length"],[54,24,99,20],[54,26,99,22],[55,10,100,6],[55,14,100,12,"task"],[55,18,100,16],[55,21,100,19,"queue"],[55,26,100,24],[55,27,100,25,"shift"],[55,32,100,30],[55,33,100,31],[55,34,100,32],[56,10,101,6],[56,14,101,10],[57,12,102,8],[57,16,102,12],[57,23,102,19,"task"],[57,27,102,23],[57,32,102,28],[57,40,102,36],[57,44,102,40,"task"],[57,48,102,44],[57,49,102,45,"gen"],[57,52,102,48],[57,54,102,50],[58,14,103,10,"DEBUG"],[58,19,103,15],[58,23,103,19,"infoLog"],[58,30,103,26],[58,31,103,27],[58,64,103,60],[58,67,103,63,"task"],[58,71,103,67],[58,72,103,68,"name"],[58,76,103,72],[58,77,103,73],[59,14,104,10],[59,18,104,14],[59,19,104,15,"_genPromise"],[59,30,104,26],[59,31,104,27,"task"],[59,35,104,31],[59,36,104,32],[60,12,105,8],[60,13,105,9],[60,19,105,15],[60,23,105,19],[60,30,105,26,"task"],[60,34,105,30],[60,39,105,35],[60,47,105,43],[60,51,105,47,"task"],[60,55,105,51],[60,56,105,52,"run"],[60,59,105,55],[60,61,105,57],[61,14,106,10,"DEBUG"],[61,19,106,15],[61,23,106,19,"infoLog"],[61,30,106,26],[61,31,106,27],[61,53,106,49],[61,56,106,52,"task"],[61,60,106,56],[61,61,106,57,"name"],[61,65,106,61],[61,66,106,62],[62,14,107,10,"task"],[62,18,107,14],[62,19,107,15,"run"],[62,22,107,18],[62,23,107,19],[62,24,107,20],[63,12,108,8],[63,13,108,9],[63,19,108,15],[64,14,109,10,"invariant"],[64,23,109,19],[64,24,110,12],[64,31,110,19,"task"],[64,35,110,23],[64,40,110,28],[64,50,110,38],[64,52,111,12],[64,111,111,71],[64,114,112,14,"JSON"],[64,118,112,18],[64,119,112,19,"stringify"],[64,128,112,28],[64,129,112,29,"task"],[64,133,112,33],[64,135,112,35],[64,139,112,39],[64,141,112,41],[64,142,112,42],[64,143,113,10],[64,144,113,11],[65,14,114,10,"DEBUG"],[65,19,114,15],[65,23,114,19,"infoLog"],[65,30,114,26],[65,31,114,27],[65,62,114,58],[65,63,114,59],[66,14,115,10,"task"],[66,18,115,14],[66,19,115,15],[66,20,115,16],[67,12,116,8],[68,10,117,6],[68,11,117,7],[68,12,117,8],[68,19,117,15,"e"],[68,20,117,16],[68,22,117,18],[69,12,118,8,"e"],[69,13,118,9],[69,14,118,10,"message"],[69,21,118,17],[69,24,120,10],[69,53,120,39],[69,57,120,43,"task"],[69,61,120,47],[69,62,120,48,"name"],[69,66,120,52],[69,70,120,56],[69,72,120,58],[69,73,120,59],[69,76,120,62],[69,80,120,66],[69,83,120,69,"e"],[69,84,120,70],[69,85,120,71,"message"],[69,92,120,78],[70,12,121,8],[70,18,121,14,"e"],[70,19,121,15],[71,10,122,6],[72,8,123,4],[73,6,124,2],[74,4,124,3],[75,6,124,3,"key"],[75,9,124,3],[76,6,124,3,"value"],[76,11,124,3],[76,13,133,2],[76,22,133,2,"_getCurrentQueue"],[76,38,133,18,"_getCurrentQueue"],[76,39,133,18],[76,41,133,34],[77,8,134,4],[77,12,134,10,"stackIdx"],[77,20,134,18],[77,23,134,21],[77,27,134,25],[77,28,134,26,"_queueStack"],[77,39,134,37],[77,40,134,38,"length"],[77,46,134,44],[77,49,134,47],[77,50,134,48],[78,8,135,4],[78,12,135,10,"queue"],[78,17,135,15],[78,20,135,18],[78,24,135,22],[78,25,135,23,"_queueStack"],[78,36,135,34],[78,37,135,35,"stackIdx"],[78,45,135,43],[78,46,135,44],[79,8,136,4],[79,12,137,6,"queue"],[79,17,137,11],[79,18,137,12,"popable"],[79,25,137,19],[79,29,138,6,"queue"],[79,34,138,11],[79,35,138,12,"tasks"],[79,40,138,17],[79,41,138,18,"length"],[79,47,138,24],[79,52,138,29],[79,53,138,30],[79,57,139,6],[79,61,139,10],[79,62,139,11,"_queueStack"],[79,73,139,22],[79,74,139,23,"length"],[79,80,139,29],[79,83,139,32],[79,84,139,33],[79,86,140,6],[80,10,141,6],[80,14,141,10],[80,15,141,11,"_queueStack"],[80,26,141,22],[80,27,141,23,"pop"],[80,30,141,26],[80,31,141,27],[80,32,141,28],[81,10,142,6,"DEBUG"],[81,15,142,11],[81,19,143,8,"infoLog"],[81,26,143,15],[81,27,143,16],[81,54,143,43],[81,56,143,45],[82,12,144,10,"stackIdx"],[82,20,144,18],[82,22,144,10,"stackIdx"],[82,30,144,18],[83,12,145,10,"queueStackSize"],[83,26,145,24],[83,28,145,26],[83,32,145,30],[83,33,145,31,"_queueStack"],[83,44,145,42],[83,45,145,43,"length"],[84,10,146,8],[84,11,146,9],[84,12,146,10],[85,10,147,6],[85,17,147,13],[85,21,147,17],[85,22,147,18,"_getCurrentQueue"],[85,38,147,34],[85,39,147,35],[85,40,147,36],[86,8,148,4],[86,9,148,5],[86,15,148,11],[87,10,149,6],[87,17,149,13,"queue"],[87,22,149,18],[87,23,149,19,"tasks"],[87,28,149,24],[88,8,150,4],[89,6,151,2],[90,4,151,3],[91,6,151,3,"key"],[91,9,151,3],[92,6,151,3,"value"],[92,11,151,3],[92,13,153,2],[92,22,153,2,"_genPromise"],[92,33,153,13,"_genPromise"],[92,34,153,14,"task"],[92,38,153,31],[92,40,153,33],[93,8,153,33],[93,12,153,33,"_this2"],[93,18,153,33],[94,8,158,4],[94,12,158,8],[94,13,158,9,"_queueStack"],[94,24,158,20],[94,25,158,21,"push"],[94,29,158,25],[94,30,158,26],[95,10,158,27,"tasks"],[95,15,158,32],[95,17,158,34],[95,19,158,36],[96,10,158,38,"popable"],[96,17,158,45],[96,19,158,47],[97,8,158,52],[97,9,158,53],[97,10,158,54],[98,8,159,4],[98,12,159,10,"stackIdx"],[98,20,159,18],[98,23,159,21],[98,27,159,25],[98,28,159,26,"_queueStack"],[98,39,159,37],[98,40,159,38,"length"],[98,46,159,44],[98,49,159,47],[98,50,159,48],[99,8,160,4],[99,12,160,10,"stackItem"],[99,21,160,19],[99,24,160,22],[99,28,160,26],[99,29,160,27,"_queueStack"],[99,40,160,38],[99,41,160,39,"stackIdx"],[99,49,160,47],[99,50,160,48],[100,8,161,4,"DEBUG"],[100,13,161,9],[100,17,161,13,"infoLog"],[100,24,161,20],[100,25,161,21],[100,54,161,50],[100,56,161,52],[101,10,161,53,"stackIdx"],[101,18,161,61],[101,20,161,53,"stackIdx"],[102,8,161,61],[102,9,161,62],[102,10,161,63],[103,8,162,4,"DEBUG"],[103,13,162,9],[103,17,162,13,"infoLog"],[103,24,162,20],[103,25,162,21],[103,52,162,48],[103,55,162,51,"task"],[103,59,162,55],[103,60,162,56,"name"],[103,64,162,60],[103,65,162,61],[104,8,163,4,"task"],[104,12,163,8],[104,13,164,7,"gen"],[104,16,164,10],[104,17,164,11],[104,18,164,12],[104,19,165,7,"then"],[104,23,165,11],[104,24,165,12],[104,36,165,18],[105,10,166,8,"DEBUG"],[105,15,166,13],[105,19,167,10,"infoLog"],[105,26,167,17],[105,27,167,18],[105,60,167,51],[105,63,167,54,"task"],[105,67,167,58],[105,68,167,59,"name"],[105,72,167,63],[105,74,167,65],[106,12,168,12,"stackIdx"],[106,20,168,20],[106,22,168,12,"stackIdx"],[106,30,168,20],[107,12,169,12,"queueStackSize"],[107,26,169,26],[107,28,169,28,"_this2"],[107,34,169,32],[107,35,169,33,"_queueStack"],[107,46,169,44],[107,47,169,45,"length"],[108,10,170,10],[108,11,170,11],[108,12,170,12],[109,10,171,8,"stackItem"],[109,19,171,17],[109,20,171,18,"popable"],[109,27,171,25],[109,30,171,28],[109,34,171,32],[110,10,172,8,"_this2"],[110,16,172,12],[110,17,172,13,"hasTasksToProcess"],[110,34,172,30],[110,35,172,31],[110,36,172,32],[110,40,172,36,"_this2"],[110,46,172,40],[110,47,172,41,"_onMoreTasks"],[110,59,172,53],[110,60,172,54],[110,61,172,55],[111,8,173,6],[111,9,173,7],[111,10,173,8],[111,11,174,7,"catch"],[111,16,174,12],[111,17,174,13],[111,27,174,13,"ex"],[111,29,174,15],[111,31,174,19],[112,10,175,8,"setTimeout"],[112,20,175,18],[112,21,175,19],[112,33,175,25],[113,12,176,10,"ex"],[113,14,176,12],[113,15,176,13,"message"],[113,22,176,20],[113,25,176,23],[113,71,176,69,"task"],[113,75,176,73],[113,76,176,74,"name"],[113,80,176,78],[113,85,176,83,"ex"],[113,87,176,85],[113,88,176,86,"message"],[113,95,176,93],[113,97,176,95],[114,12,177,10],[114,18,177,16,"ex"],[114,20,177,18],[115,10,178,8],[115,11,178,9],[115,13,178,11],[115,14,178,12],[115,15,178,13],[116,8,179,6],[116,9,179,7],[116,10,179,8],[117,6,180,2],[118,4,180,3],[119,2,180,3],[120,2,183,0,"module"],[120,8,183,6],[120,9,183,7,"exports"],[120,16,183,14],[120,19,183,17,"TaskQueue"],[120,28,183,26],[121,0,183,27],[121,3]],"functionMap":{"names":["<global>","TaskQueue","constructor","enqueue","enqueueTasks","tasks.forEach$argument_0","cancelTasks","_queueStack.map$argument_0","queue.tasks.filter$argument_0","_queueStack.map.filter$argument_0","hasTasksToProcess","processNext","_getCurrentQueue","_genPromise","task.gen.then$argument_0","task.gen.then._catch$argument_0","setTimeout$argument_0"],"mappings":"AAA;AC2C;ECQ;GDG;EEO;GFE;EGE;kBCC,0BD;GHC;EKE;WCG;kCCE,0CD;QDC;cGC,mDH;GLC;ESY;GTE;EUK;GV2B;EWS;GXkB;EYE;YCY;ODQ;aEC;mBCC;SDG;OFC;GZC;CDC"},"hasCjsExports":true},"type":"js/module"}]}